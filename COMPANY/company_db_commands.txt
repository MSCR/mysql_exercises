# Create schema (Database)
CREATE SCHEMA COMPANY

# Create tables(relations)
# Foreign keys are added after adding some rows(tupples) to the tables.
CREATE TABLE EMPLOYEE
	(Fname		VARCHAR(15)	NOT NULL,
	 Minit		CHAR,
   	 Lname		VARCHAR(15)	NOT NULL,
   	 Ssn		CHAR(9)		NOT NULL	PRIMARY KEY,
  	 Bdate		DATE,
  	 Address	VARCHAR(30),
 	 Sex		CHAR,
	 Salary		DECIMAL(10,2),
	 Super_ssn	CHAR(9),
	 Dno		INT		NOT NULL);

CREATE TABLE DEPARTMENT
	(Dname		VARCHAR(15)	NOT NULL	UNIQUE,
	 Dnumber	INT		NOT NULL	PRIMARY KEY,
	 Mgr_ssn	CHAR(9)		NOT NULL,
	 Mgr_start_date	DATE);

CREATE TABLE DEPT_LOCATION
	(Dnumber	INT		NOT NULL,
	 Dlocation	VARCHAR(15)	NOT NULL,
	 PRIMARY KEY (Dnumber, Dlocation),);

CREATE TABLE PROJECT
	(Pname		VARCHAR(15)	NOT NULL	UNIQUE,
	 Pnumber	INT		NOT NULL	PRIMARY KEY,
	 Plocation	VARCHAR(15),
	 Dnum		INT		NOT NULL);

CREATE TABLE WORKS_ON
	(Essn	CHAR(9)		NOT NULL,
	 Pno	INT		NOT NULL,
	 Hours	DECIMAL(3,1)	NOT NULL,
	 PRIMARY KEY (Essn, Pno));

CREATE TABLE DEPENDENT
	(Essn		CHAR(9)		NOT NULL,
	 Dependent_name	CHAR(15)	NOT NULL,
	 Sex		CHAR,
	 Bdate		DATE,
	 Relationship	VARCHAR(8),
	 PRIMARY KEY(Essn, Dependent_name));

# Insert tupples to the relations
# In order to fill the tables, all the information will be loaded from CSV files, ignore first line because it's the headers.
LOAD DATA LOCAL INFILE '/path/to/file/EMPLOYEE.csv' INTO TABLE COMPANY.EMPLOYEE FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES;

LOAD DATA LOCAL INFILE '/path/to/file/DEPARTMENT.csv' INTO TABLE COMPANY.DEPARTMENT FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' IGNORE 1 LINES;

LOAD DATA LOCAL INFILE '/path/to/file/DEPT_LOCATION.csv' INTO TABLE COMPANY.DEPT_LOCATION FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' IGNORE 1 LINES;

LOAD DATA LOCAL INFILE '/path/to/file/PROJECT.csv' INTO TABLE COMPANY.PROJECT FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' IGNORE 1 LINES;

LOAD DATA LOCAL INFILE '/path/to/file/WORKS_ON.csv' INTO TABLE COMPANY.WORKS_ON FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' IGNORE 1 LINES;

LOAD DATA LOCAL INFILE '/path/to/file/DEPENDENT.csv' INTO TABLE COMPANY.DEPENDENT FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' IGNORE 1 LINES;

# To check data in the the data in the tables
SELECT * FROM COMPANY.EMPLOYEE;
SELECT * FROM COMPANY.DEPARTMENT;
SELECT * FROM COMPANY.DEPT_LOCATION;
SELECT * FROM COMPANY.PROJECT;
SELECT * FROM COMPANY.WORKS_ON;
SELECT * FROM COMPANY.DEPENDENT;

# Add key constrains to the tables
ALTER TABLE COMPANY.EMPLOYEE ADD FOREIGN KEY(Super_ssn) REFERENCES COMPANY.EMPLOYEE(Ssn);
ALTER TABLE COMPANY.EMPLOYEE ADD FOREIGN KEY(Dno) REFERENCES COMPANY.DEPARTMENT(Dnumber);

ALTER TABLE COMPANY.DEPARTMENT ADD FOREIGN KEY(Mgr_ssn) REFERENCES COMPANY.EMPLOYEE(Ssn);

ALTER TABLE COMPANY.DEPT_LOCATION ADD FOREIGN KEY(Dnumber) REFERENCES COMPANY.DEPARTMENT(Dnumber);

ALTER TABLE COMPANY.PROJECT ADD FOREIGN KEY(Dnum) REFERENCES COMPANY.DEPARTMENT(Dnumber);

ALTER TABLE COMPANY.WORKS_ON ADD FOREIGN KEY(Essn) REFERENCES COMPANY.EMPLOYEE(Ssn);
ALTER TABLE COMPANY.WORKS_ON ADD FOREIGN KEY(Pno) REFERENCES COMPANY.PROJECT(Pnumber);

ALTER TABLE COMPANY.DEPENDENT ADD FOREIGN KEY(Essn) REFERENCES COMPANY.EMPLOYEE(Ssn);

# To check constrains 
SELECT TABLE_NAME, COLUMN_NAME, CONSTRINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = "EMPLOYEE"

SELECT TABLE_NAME, COLUMN_NAME, CONSTRINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = "DEPARTMENT"

SELECT TABLE_NAME, COLUMN_NAME, CONSTRINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = "DEPT_LOCATION"

SELECT TABLE_NAME, COLUMN_NAME, CONSTRINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = "PROJECT"

SELECT TABLE_NAME, COLUMN_NAME, CONSTRINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = "WORKS_ON"

SELECT TABLE_NAME, COLUMN_NAME, CONSTRINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = "DEPENDENT"
